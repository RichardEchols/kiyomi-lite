<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiyomi ‚Äî Setup</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Step 1: Welcome -->
        <div class="step active" id="step-1">
            <div class="card">
                <div class="emoji-large">üå∏</div>
                <h1>Hi, I'm Kiyomi</h1>
                <p class="subtitle">Your personal AI assistant. Let's get you set up ‚Äî it only takes a minute.</p>
                <div class="input-group">
                    <label for="user-name">What's your name?</label>
                    <input type="text" id="user-name" placeholder="e.g. Sarah" autocomplete="given-name" autofocus>
                </div>
                <button class="btn-primary" onclick="nextStep(1)" id="btn-step1">Continue</button>
            </div>
        </div>

        <!-- Step 2: Connect AI -->
        <div class="step" id="step-2">
            <div class="card">
                <div class="emoji-large">üß†</div>
                <h1>Connect Your AI</h1>
                <p class="subtitle">Kiyomi works with your existing AI subscription ‚Äî no extra costs, no API keys.</p>

                <!-- Subscription picker -->
                <div class="provider-grid" id="sub-grid">
                    <div class="provider-card" onclick="selectSubscription('claude')" id="sub-claude">
                        <div class="provider-icon">ü§ñ</div>
                        <div class="provider-name">Claude</div>
                        <div class="provider-tag">Pro / Max ¬∑ $20/mo</div>
                    </div>
                    <div class="provider-card" onclick="selectSubscription('codex')" id="sub-codex">
                        <div class="provider-icon">üí¨</div>
                        <div class="provider-name">ChatGPT</div>
                        <div class="provider-tag">Plus ¬∑ $20/mo</div>
                    </div>
                    <div class="provider-card" onclick="selectSubscription('gemini')" id="sub-gemini">
                        <div class="provider-icon">‚ú®</div>
                        <div class="provider-name">Gemini</div>
                        <div class="provider-tag">Google One AI ¬∑ $20/mo</div>
                    </div>
                </div>

                <!-- Connection status panel -->
                <div id="connect-panel" class="walkthrough-box" style="display:none;">
                    <div id="connect-checking" style="display:none;">
                        <div class="import-progress">
                            <div class="spinner"></div>
                            <div>
                                <strong id="connect-action">Checking...</strong>
                                <p class="progress-hint" id="connect-hint">This may open your browser to sign in.</p>
                            </div>
                        </div>
                    </div>
                    <div id="connect-ready" style="display:none;">
                        <p class="walkthrough-note" id="connect-result"></p>
                        <p id="connect-account" style="margin:4px 0 0; font-size:13px; color:var(--text-secondary);"></p>
                        <button class="btn-outline" id="btn-switch-account" onclick="switchAccount()" style="display:none; margin-top:8px; font-size:12px;">Not your account? Sign in with a different one</button>
                    </div>
                    <div id="connect-needs-auth" style="display:none;">
                        <p class="walkthrough-title" id="auth-title">Sign in to connect</p>
                        <p style="margin-bottom:12px; font-size:14px; color:var(--text-secondary);" id="auth-desc">
                            Click below to sign in with your subscription account. A browser window will open.
                        </p>
                        <button class="btn-action" onclick="triggerAuth()" id="btn-auth">Sign In</button>
                    </div>
                </div>

                <!-- Advanced: API key fallback (collapsed) -->
                <details id="api-key-fallback" style="margin-top: 16px;">
                    <summary style="cursor:pointer; color: var(--text-hint); font-size: 13px;">Advanced: Use an API key instead</summary>
                    <div style="margin-top: 12px;">
                        <div class="provider-grid" style="margin-bottom: 12px;">
                            <div class="provider-card" onclick="selectProvider('gemini')" id="prov-gemini" style="padding: 12px 8px;">
                                <div class="provider-name" style="font-size: 13px;">Gemini</div>
                                <div class="provider-tag free" style="font-size: 10px;">Free</div>
                            </div>
                            <div class="provider-card" onclick="selectProvider('anthropic')" id="prov-anthropic" style="padding: 12px 8px;">
                                <div class="provider-name" style="font-size: 13px;">Claude</div>
                                <div class="provider-tag" style="font-size: 10px;">Paid</div>
                            </div>
                            <div class="provider-card" onclick="selectProvider('openai')" id="prov-openai" style="padding: 12px 8px;">
                                <div class="provider-name" style="font-size: 13px;">ChatGPT</div>
                                <div class="provider-tag" style="font-size: 10px;">Paid</div>
                            </div>
                        </div>
                        <div class="input-group" id="key-group">
                            <label for="api-key">Paste your API key:</label>
                            <input type="password" id="api-key" placeholder="AIzaSy... or sk-...">
                        </div>
                    </div>
                </details>

                <div class="btn-row" style="margin-top: 16px;">
                    <button class="btn-secondary" onclick="prevStep(2)">Back</button>
                    <button class="btn-primary" onclick="nextStep(2)" id="btn-step2">Continue</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Connect Telegram -->
        <div class="step" id="step-3">
            <div class="card">
                <div class="emoji-large">üí¨</div>
                <h1>Connect Telegram</h1>
                <p class="subtitle">Kiyomi lives in Telegram ‚Äî message her like texting a friend. Takes about 60 seconds.</p>

                <div id="tg-manual">
                    <div class="walkthrough-box">
                        <p class="walkthrough-title">Create your personal bot:</p>
                        <div class="walkthrough-steps">
                            <div class="wt-step">
                                <span class="wt-num">1</span>
                                <div>
                                    <p><strong>Get Telegram</strong> if you don't have it:</p>
                                    <div class="wt-buttons">
                                        <a href="https://apps.apple.com/app/telegram-messenger/id686449807" target="_blank" class="btn-action btn-small">iPhone / iPad</a>
                                        <a href="https://play.google.com/store/apps/details?id=org.telegram.messenger" target="_blank" class="btn-action btn-small">Android</a>
                                        <a href="https://desktop.telegram.org" target="_blank" class="btn-action btn-small">Mac / PC</a>
                                    </div>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">2</span>
                                <div>
                                    <p><strong>Open BotFather</strong> in Telegram:</p>
                                    <a href="https://t.me/BotFather" target="_blank" class="btn-action">Open @BotFather ‚Üí</a>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">3</span>
                                <div>
                                    <p>Send <strong>/newbot</strong>, pick any name, pick a username ending in "bot"</p>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">4</span>
                                <div>
                                    <p><strong>Paste the token</strong> BotFather gives you:</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="tg-token">Bot token:</label>
                        <input type="text" id="tg-token" placeholder="123456789:ABCdefGhIjKlMnOpQrStUvWxYz">
                    </div>
                </div>

                <div class="btn-row" style="margin-top: 16px;">
                    <button class="btn-secondary" onclick="prevStep(3)">Back</button>
                    <button class="btn-primary" onclick="nextStep(3)" id="btn-step3">Continue</button>
                </div>
            </div>
        </div>

        <!-- Step 4: Import Chats (Optional) -->
        <div class="step" id="step-4">
            <div class="card">
                <div class="emoji-large">üìö</div>
                <h1>Import Your Chats</h1>
                <p class="subtitle">Optional: Bring your AI chat history so I already know you from day one.</p>

                <div class="btn-row" style="margin-bottom: 16px;">
                    <button class="btn-primary" onclick="skipImport()" style="flex: 2;">Skip ‚Äî I'll learn as we go! ‚Üí</button>
                </div>

                <details id="import-guide">
                    <summary style="cursor:pointer; color: var(--pink); font-weight: 600; margin-bottom: 12px;">üìã I want to import my chats ‚Äî show me how</summary>

                    <div class="walkthrough-box" style="margin-top: 8px;">
                        <div class="walkthrough-steps">
                            <div class="wt-step">
                                <span class="wt-num">üì±</span>
                                <div>
                                    <p><strong>From Google Gemini:</strong></p>
                                    <p>1. Go to <a href="https://takeout.google.com" target="_blank" class="btn-action btn-small">Google Takeout</a></p>
                                    <p>2. Click "Deselect all", then scroll down and check <strong>"Gemini Apps"</strong></p>
                                    <p>3. Click "Next step" ‚Üí "Create export" ‚Üí wait for email</p>
                                    <p>4. Download the .zip file and drop it below</p>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">üí¨</span>
                                <div>
                                    <p><strong>From ChatGPT:</strong></p>
                                    <p>1. Go to <a href="https://chatgpt.com/#settings" target="_blank" class="btn-action btn-small">ChatGPT Settings</a></p>
                                    <p>2. Click "Data controls" ‚Üí "Export data" ‚Üí "Confirm export"</p>
                                    <p>3. Check your email for the download link</p>
                                    <p>4. Unzip and drop <strong>conversations.json</strong> below</p>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">ü§ñ</span>
                                <div>
                                    <p><strong>From Claude:</strong></p>
                                    <p>1. Go to <a href="https://claude.ai/settings" target="_blank" class="btn-action btn-small">Claude Settings</a></p>
                                    <p>2. Scroll to "Export Data" ‚Üí click "Export"</p>
                                    <p>3. Check your email for the download</p>
                                    <p>4. Drop the .json file below</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="drop-zone" id="drop-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                        <div class="drop-icon">üìÅ</div>
                        <p class="drop-text">Drag & drop your export file here</p>
                        <p class="drop-hint">Supports: .json or .zip files</p>
                        <input type="file" id="import-file" accept=".json,.zip" style="display:none" onchange="handleFileSelect(event)">
                        <button class="btn-outline" onclick="document.getElementById('import-file').click()">Or choose a file</button>
                    </div>
                    <div id="import-status" class="import-status" style="display:none;"></div>
                    
                    <div class="btn-row" style="margin-top: 12px;">
                        <button class="btn-secondary" onclick="prevStep(4)">Back</button>
                        <button class="btn-primary" onclick="nextStep(4)">Import & Continue</button>
                    </div>
                </details>

                <div class="btn-row" style="margin-top: 4px;">
                    <button class="btn-secondary" onclick="prevStep(4)">Back</button>
                </div>
            </div>
        </div>

        <!-- Step 5: All Done -->
        <div class="step" id="step-5">
            <div class="card done-card">
                <div class="confetti">üéâ</div>
                <div class="emoji-large">üå∏</div>
                <h1>You're all set, <span id="done-name">friend</span>!</h1>
                <p class="subtitle" id="done-subtitle">Setting up your assistant...</p>
                
                <div id="done-loading" style="padding: 20px; text-align: center;">
                    <p>‚è≥ Installing AI packages (first time only, about 30 seconds)...</p>
                </div>

                <div id="done-ready" style="display: none;">
                    <div class="walkthrough-box" id="find-bot-box">
                        <p class="walkthrough-title">üì± Now let's start chatting!</p>
                        <div class="walkthrough-steps">
                            <div class="wt-step">
                                <span class="wt-num">1</span>
                                <p>Open Telegram on your phone or computer</p>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">2</span>
                                <div>
                                    <p>Click this link to open your assistant:</p>
                                    <a href="#" id="bot-deep-link" target="_blank" class="btn-action">Open Your Assistant in Telegram ‚Üí</a>
                                </div>
                            </div>
                            <div class="wt-step">
                                <span class="wt-num">3</span>
                                <p>Tap <strong>Start</strong> and say hello! üëã</p>
                            </div>
                        </div>
                    </div>

                    <div class="done-features">
                        <div class="feature-item">
                            <span>üí≠</span>
                            <p>I remember our conversations</p>
                        </div>
                        <div class="feature-item">
                            <span>‚è∞</span>
                            <p>I can set reminders for you</p>
                        </div>
                        <div class="feature-item">
                            <span>üß†</span>
                            <p>I learn your preferences over time</p>
                        </div>
                        <div class="feature-item">
                            <span>üì±</span>
                            <p>Message me from any device via Telegram</p>
                        </div>
                    </div>
                </div>

                <p class="done-hint">I'll be in your menu bar üå∏ whenever you need me.</p>
            </div>
        </div>

        <!-- Progress Dots -->
        <div class="progress-dots">
            <span class="dot active" data-step="1"></span>
            <span class="dot" data-step="2"></span>
            <span class="dot" data-step="3"></span>
            <span class="dot" data-step="4"></span>
            <span class="dot" data-step="5"></span>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
